{% extends "layout.html" %}
{% block content %}

<div class="header text-center mb-4">
    <h1>üìö Vybran√© Piesne</h1>
    <p class="lead mb-3">Zobrazen√© piesne: <strong>{{ song_ids }}</strong></p>
    
    <div class="d-flex justify-content-center gap-3 mb-3">
        <a href="{{ url_for('index') }}" class="btn btn-outline-primary">
            <i class="bi bi-arrow-left me-1"></i>Sp√§≈• na hlavn√Ω zoznam
        </a>
        <button class="btn btn-outline-info" onclick="copyToClipboard('{{ url_for('songs_view', song_ids=song_ids, _external=True) }}', this)">
            <i class="bi bi-link me-1"></i>Kop√≠rova≈• link
        </button>
    </div>
</div>

<style>
.bg-success-light {
  background-color:rgb(127, 202, 145);
}

/* Enhanced song listing styles */
.songs-table-container {
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255,255,255,0.2);
}

.song-table {
  border-radius: 1rem;
  overflow: hidden;
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(20px);
}

.song-table tbody tr {
  transition: all 0.2s ease;
}

.song-table tbody tr:hover {
  background-color: rgba(52, 152, 219, 0.08) !important;
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.badge-checked {
  background: linear-gradient(45deg, #27ae60, #2ecc71) !important;
  color: white !important;
  border: none;
  font-weight: 600;
}

.badge-pending {
  background: linear-gradient(45deg, #f39c12, #e67e22) !important;
  color: white !important;
  border: none;
  font-weight: 600;
}

.badge-printed {
  background: linear-gradient(45deg, #8e44ad, #9b59b6) !important;
  color: white !important;
  border: none;
  font-weight: 600;
}

.pulse-animation {
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.8; transform: scale(1.05); }
  100% { opacity: 1; transform: scale(1); }
}

.pulse-subtle {
  animation: pulse-subtle 3s infinite;
}

@keyframes pulse-subtle {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}

/* Mobile card layout styles */
.mobile-songs-container {
  display: none; /* Hidden by default, shown on mobile */
  padding: 0.5rem;
  position: relative;
  z-index: 1;
}

.mobile-song-card {
  background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
  border: 1px solid rgba(0,0,0,0.08);
  border-radius: 20px;
  margin-bottom: 1.25rem;
  padding: 1rem;
  box-shadow: 0 4px 15px rgba(0,0,0,0.08);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: visible;
}

.mobile-song-card:hover {
  box-shadow: 0 8px 30px rgba(0,0,0,0.15);
  transform: translateY(-4px) scale(1.02);
  border-color: rgba(102, 126, 234, 0.3);
}

/* Status indicator stripe */
.mobile-song-card::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 4px;
  height: 100%;
  background: linear-gradient(180deg, #28a745 0%, #20c997 100%);
  border-radius: 0 16px 16px 0;
  opacity: 0.8;
}

.mobile-song-card[data-checked="false"]::after {
  background: linear-gradient(180deg, #ffc107 0%, #fd7e14 100%);
}

.mobile-song-card[data-printed="true"]::after {
  background: linear-gradient(180deg, #007bff 0%, #6f42c1 100%);
}

.mobile-song-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 1rem;
  position: relative;
}

.mobile-song-info {
  flex-grow: 1;
  padding-right: 0.5rem;
  width: 100%;
}

.mobile-song-title {
  font-size: 1.1rem;
  font-weight: 700;
  color: #2c3e50;
  line-height: 1.3;
  word-wrap: break-word;
  background: linear-gradient(135deg, #2c3e50, #3498db);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.mobile-song-author {
  font-size: 0.9rem;
  color: #6c757d;
  margin-bottom: 0.5rem;
  font-weight: 500;
  display: flex;
  align-items: center;
  gap: 0.3rem;
}

.mobile-song-author i {
  color: #007bff;
  font-size: 0.8rem;
}

.mobile-song-id {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  font-size: 0.75rem;
  font-weight: 700;
  padding: 0.3rem 0.7rem;
  border-radius: 15px;
  white-space: nowrap;
  box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
  align-self: flex-start;
  min-width: 40px;
  text-align: center;
}

.mobile-song-actions-grid {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr 1fr;
  gap: 0.5rem;
  margin-bottom: 1rem;
}

.mobile-song-actions {
  display: flex;
  gap: 0.75rem;
  align-items: center;
  margin-bottom: 1rem;
  flex-wrap: wrap;
}

.mobile-song-actions-grid .btn {
  border-radius: 10px;
  font-weight: 600;
  padding: 0.6rem !important;
  font-size: 2rem !important;
  transition: all 0.3s ease;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.2rem;
  text-align: center;
  min-height: 60px;
  justify-content: center;
}

.mobile-song-actions-grid .btn i {
  font-size: 2.5rem !important;
}

.mobile-song-actions-grid .btn span {
  font-size: 2rem !important;
  line-height: 1.1;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 100%;
  font-weight: 600;
}

.mobile-song-actions-grid .btn:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(0,0,0,0.2);
}

.mobile-song-actions-grid .btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* Status badges with modern styling */
.mobile-song-card .badge {
  font-size: 0.75rem;
  padding: 0.4rem 0.8rem;
  border-radius: 12px;
  font-weight: 600;
  margin: 0.2rem;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  border: 1px solid rgba(255,255,255,0.2);
}

.mobile-song-card .badge.bg-success {
  background: linear-gradient(135deg, #28a745 0%, #20c997 100%) !important;
}

.mobile-song-card .badge.bg-warning {
  background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%) !important;
  color: white !important;
}

.mobile-song-card .badge.bg-info {
  background: linear-gradient(135deg, #17a2b8 0%, #6610f2 100%) !important;
}

.mobile-expandable {
  border-top: 1px solid #f0f0f0;
  padding-top: 1rem;
  margin-top: 1rem;
  background: #fafafa;
  border-radius: 12px;
  padding: 1rem;
  margin: 1rem -0.25rem 0;
}

.mobile-expand-toggle {
  background: #ffffff;
  border: 1px solid #e9ecef;
  color: #6c757d;
  font-size: 0.9rem;
  padding: 0.6rem 1.2rem;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  transition: all 0.3s ease;
  border-radius: 25px;
  font-weight: 500;
  width: 100%;
  box-shadow: 0 1px 3px rgba(0,0,0,0.05);
}

.mobile-expand-toggle:hover {
  background: #f8f9fa;
  color: #495057;
  border-color: #dee2e6;
  transform: translateY(-1px);
  box-shadow: 0 2px 6px rgba(0,0,0,0.08);
}

.mobile-expand-toggle.expanded {
  background: #f1f3f4;
  color: #495057;
  border-color: #d1ecf1;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.mobile-expand-toggle .bi-chevron-down {
  transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  font-size: 1rem;
}

.mobile-expand-toggle.expanded .bi-chevron-down {
  transform: rotate(180deg);
}

.mobile-expanded-content {
  padding-top: 1rem;
  display: none;
  animation: fadeInUp 0.3s ease-out;
  background: #ffffff;
  border-radius: 8px;
  padding: 1rem;
  margin-top: 0.75rem;
  border: 1px solid #f0f0f0;
}

.mobile-expanded-content.show {
  display: block;
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(15px) scale(0.98);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

.mobile-files-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  gap: 0.75rem;
  margin-top: 1rem;
}

.mobile-files-grid .btn {
  border-radius: 10px;
  font-weight: 600;
  padding: 0.6rem;
  font-size: 0.8rem;
  transition: all 0.3s ease;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.mobile-status-badges {
  display: flex;
  gap: 0.4rem;
  flex-wrap: wrap;
  margin-top: 1rem;
  padding: 0.75rem;
  background: rgba(255,255,255,0.7);
  border-radius: 10px;
  border: 1px solid rgba(0,0,0,0.05);
}

/* Status badges on the right side, overlapping - matching index.html style */
.mobile-status-badges-left {
    position: relative;
    min-width: 32px;
    height: 32px;
    flex-shrink: 0;
}

.mobile-status-badges-left .status-icon {
    position: absolute;
    width: 28px;
    height: 28px;
    font-size: 0.9rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    border: 2px solid white;
    top: 0;
    left: 0;
}

/* Overlapping positioning - printed badge behind, checked badge in front */
.mobile-status-badges-left .status-icon.status-printed {
    z-index: 1;
    transform: translateX(-4px);
}

.mobile-status-badges-left .status-icon.status-checked {
    z-index: 2;
    transform: translateX(4px) translateY(4px);
}

/* Alternative positioning using nth-child for fallback */
.mobile-status-badges-left .status-icon:first-child {
    z-index: 1;
    transform: translateX(-4px);
}

.mobile-status-badges-left .status-icon:nth-child(2) {
    z-index: 2;
    transform: translateX(4px) translateY(4px);
}

.status-icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 28px;
  height: 28px;
  border-radius: 50%;
  font-size: 1rem;
  cursor: pointer;
  transition: all 0.3s ease;
  border: 2px solid transparent;
}

/* Smaller status icons for mobile badges under song ID */
.mobile-status-badges .status-icon {
  width: 24px;
  height: 24px;
  font-size: 0.9rem;
}

/* Audio icons can be slightly larger */
.mobile-audio-icons .status-icon {
  width: 28px;
  height: 28px;
  font-size: 1rem;
}

.status-icon:hover {
  transform: scale(1.15);
  box-shadow: 0 4px 16px rgba(0,0,0,0.25);
  z-index: 10;
}

/* Enhanced status icon colors with gradients */
.status-printed {
  background: linear-gradient(135deg, #17a2b8 0%, #6f42c1 100%);
  color: white;
  border-color: rgba(255, 255, 255, 0.3);
  font-weight: 600;
  box-shadow: 0 2px 8px rgba(23, 162, 184, 0.3);
}

.status-checked {
  background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
  color: white;
  border-color: rgba(255, 255, 255, 0.3);
  font-weight: 600;
  box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);
}

.status-has-audio {
  background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
  color: white;
  border-color: rgba(255, 255, 255, 0.3);
  font-weight: 600;
  box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);
}

.status-no-audio {
  background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
  color: white;
  border-color: rgba(255, 255, 255, 0.3);
  font-weight: 600;
  box-shadow: 0 2px 8px rgba(108, 117, 125, 0.3);
}

/* Improved dropdown styling for mobile */
.mobile-song-actions .dropdown-menu {
  border-radius: 12px;
  border: none;
  box-shadow: 0 12px 40px rgba(0,0,0,0.25);
  padding: 0.5rem 0;
  margin-top: 0.5rem;
  z-index: 9999 !important;
  position: absolute !important;
  background: white;
  border: 1px solid rgba(0,0,0,0.1);
}

.mobile-song-actions .dropdown-item {
  padding: 0.75rem 1rem;
  font-weight: 500;
  border-radius: 8px;
  margin: 0 0.5rem;
  transition: all 0.2s ease;
}

.mobile-song-actions .dropdown-item:hover {
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
  transform: translateX(4px);
}

/* Enhanced disabled button styling */
.btn:disabled,
.btn.disabled {
    opacity: 0.4 !important;
    cursor: not-allowed !important;
    position: relative;
    border-style: dashed !important;
    border-width: 2px !important;
}

/* Disabled button overlay with prohibition symbol */
.btn:disabled::after,
.btn.disabled::after {
    content: "üö´";
    position: absolute;
    top: -8px;
    right: -8px;
    width: 20px;
    height: 20px;
    background: rgba(220, 53, 69, 0.9);
    border-radius: 50%;
    font-size: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    z-index: 10;
    border: 2px solid white;
    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
}

/* Mobile-specific tooltip styling */
.mobile-tooltip {
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 0, 0, 0.9);
    color: white;
    padding: 8px 12px;
    border-radius: 6px;
    font-size: 14px;
    white-space: nowrap;
    z-index: 1000;
    margin-bottom: 5px;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
    max-width: 250px;
    white-space: normal;
    text-align: center;
    line-height: 1.3;
}

.mobile-tooltip::after {
    content: '';
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    border: 5px solid transparent;
    border-top-color: rgba(0, 0, 0, 0.9);
}

.mobile-tooltip.show {
    opacity: 1;
}

/* Show tooltip on disabled button click/tap */
.btn:disabled:active .mobile-tooltip,
.btn.disabled:active .mobile-tooltip,
.btn:disabled.show-tooltip .mobile-tooltip,
.btn.disabled.show-tooltip .mobile-tooltip {
    opacity: 1;
}

/* Mobile responsive styles - matching index.html breakpoints */
@media (max-width: 991px) {
  /* Hide table on mobile and show card layout instead */
  .songs-table-container {
    display: none !important;
  }
  
  /* Show mobile card layout */
  .mobile-songs-container {
    display: block !important;
    padding: 0.5rem;
  }
  
  /* Enhanced mobile card styling */
  .mobile-song-card {
    margin-bottom: 1rem;
    padding: 0.875rem;
  }
  
  .mobile-song-title {
    font-size: 1.05rem;
  }
  
  .mobile-song-actions .btn {
    font-size: 0.8rem;
    padding: 0.4rem 0.8rem;
  }
  
  /* Improved touch targets */
  .mobile-expand-toggle {
    min-height: 44px;
    font-size: 0.85rem;
  }
  
  .mobile-files-grid {
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 0.5rem;
  }
  
  /* Mobile actions grid responsive */
  .mobile-song-actions-grid {
    gap: 0.5rem;
  }
  
  .mobile-song-actions-grid .btn {
    min-height: 60px !important;
    font-size: 2rem !important;
    padding: 0.6rem !important;
  }
  
  .mobile-song-actions-grid .btn i {
    font-size: 2.5rem !important;
  }
  
  .mobile-song-actions-grid .btn span {
    font-size: 2rem !important;
    font-weight: 600 !important;
  }
}
</style>

{% with messages = get_flashed_messages() %}
  {% if messages %}
    <div class="alert alert-info alert-dismissible fade show" role="alert">
      <i class="bi bi-info-circle me-2"></i>
      {{ messages[0] }}
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
  {% endif %}
{% endwith %}

<!-- Desktop table view -->
<div class="table-responsive songs-table-container shadow-sm rounded-4 overflow-hidden d-none d-lg-block">
  <table class="table table-hover mb-0 song-table">
    <thead class="table-dark">
        <tr>
            <th class="px-3 py-3">
              <i class="bi bi-hash me-1"></i>ID
            </th>
            <th class="px-3 py-3">
              <i class="bi bi-music-note me-1"></i>N√°zov
            </th>
            <th class="px-3 py-3">
              <i class="bi bi-person me-1"></i>Autor
            </th>
            <th class="text-center px-3 py-3">
              <i class="bi bi-music-note-list me-1"></i>Audio s√∫bory
            </th>
            <th class="text-center px-3 py-3">
              <i class="bi bi-download me-1"></i>S√∫bory & Status
            </th>
            <th class="text-center px-3 py-3">
              <i class="bi bi-tools me-1"></i>Funkcie
            </th>
        </tr>
    </thead>
    <tbody>
        {% for song in songs %}
        <tr id="song-{{ song.id }}" class="song-row align-middle">
            
            <td class="px-3 py-3">
              <div class="d-flex align-items-center">
                <span class="fw-bold text-primary fs-6">{{ song.song_id }}</span>
                {% if not song.admin_checked %}
                <span class="badge bg-warning ms-2 pulse-animation" title="Potrebuje kontrolu">
                  <i class="bi bi-exclamation-triangle"></i>
                </span>
                {% endif %}
              </div>
            </td>
            
            <td class="px-3 py-3">
              <div class="song-info">
                <div class="fw-bold text-dark mb-1">{{ song.title }}</div>
                
                {% if song.version_name %}
                <div class="text-muted small mb-1">
                  <i class="bi bi-tag me-1"></i>{{ song.version_name }}
                </div>
                {% endif %}
                
                {% if song.alternative_titles %}
                <div class="text-muted small">
                  <i class="bi bi-arrow-repeat me-1"></i>
                  {% for alt_title in song.alternative_titles.split(';;') %}
                    {% if alt_title.strip() %}
                      <span class="badge bg-light text-dark me-1">{{ alt_title.strip() }}</span>
                    {% endif %}
                  {% endfor %}
                </div>
                {% endif %}
              </div>
            </td>
            
            <td class="px-3 py-3">
              <div class="author-info">
                {% if song.author %}
                <div class="fw-semibold text-dark">{{ song.author }}</div>
                {% endif %}
                {% if song.author_original and song.author_original != song.author %}
                <small class="text-muted">
                  <i class="bi bi-globe me-1"></i>{{ song.author_original }}
                </small>
                {% endif %}
                {% if not song.author and not song.author_original %}
                <span class="text-muted fst-italic">Nezn√°my</span>
                {% endif %}
              </div>
            </td>
            
            <!-- Audio Files Column -->
            <td class="text-center px-3 py-3">
              <div class="audio-files">
                {% set mp3_files = song.mp3_paths|parse_json %}
                
                {% if mp3_files|length > 0 %}
                  {% if mp3_files|length == 1 %}
                    <!-- Single MP3 file - direct play button -->
                    <a href="{{ mp3_files[0] | presigned_url }}" 
                       class="btn btn-success btn-sm d-flex align-items-center justify-content-center gap-1" 
                       title="Prehra≈• MP3: {{ mp3_files[0].split('/')[-1] }}"
                       target="_blank">
                      <i class="bi bi-play-circle-fill"></i>
                      <span class="small">MP3</span>
                    </a>
                    
                  {% else %}
                    <!-- Multiple MP3 files - dropdown button -->
                    <div class="btn-group">
                      <button type="button" class="btn btn-success btn-sm dropdown-toggle d-flex align-items-center gap-1" 
                              data-bs-toggle="dropdown" aria-expanded="false"
                              title="{{ mp3_files|length }} MP3 s√∫borov">
                        <i class="bi bi-music-note-list"></i>
                        <span class="small">{{ mp3_files|length }}√ó MP3</span>
                      </button>
                      <ul class="dropdown-menu dropdown-menu-end">
                        <li><h6 class="dropdown-header"><i class="bi bi-file-music text-success me-1"></i>MP3 S√∫bory</h6></li>
                        {% for mp3_file in mp3_files %}
                          <li>
                            <a class="dropdown-item d-flex align-items-center gap-2" 
                               href="{{ mp3_file | presigned_url }}" 
                               target="_blank"
                               title="Prehra≈• {{ mp3_file.split('/')[-1] }}">
                              <i class="bi bi-play-circle-fill text-success"></i>
                              <span class="text-truncate">{{ mp3_file.split('/')[-1] }}</span>
                            </a>
                          </li>
                        {% endfor %}
                      </ul>
                    </div>
                  {% endif %}
                {% else %}
                  <span class="text-muted small">
                    <i class="bi bi-volume-mute"></i><br>≈Ωiadne MP3
                  </span>
                {% endif %}
              </div>
            </td>
            
            <!-- Files & Status Column -->
            <td class="text-center px-3 py-3">
              <div class="d-flex flex-column gap-1 align-items-center">
                <!-- Status Badges with Better Visibility -->
                <div class="mb-2 d-flex flex-wrap justify-content-center gap-1">
                  {% if song.admin_checked %}
                  <span class="badge badge-checked px-3 py-2 shadow-sm" title="Piese≈à je skontrolovan√°">
                    <i class="bi bi-check-circle-fill me-2"></i>‚úÖ Skontr.
                  </span>
                  {% else %}
                  <span class="badge badge-pending px-3 py-2 shadow-sm pulse-subtle" title="Piese≈à ƒçak√° na kontrolu">
                    <i class="bi bi-exclamation-triangle-fill me-2"></i>‚è≥ ƒåak√° kontr.
                  </span>
                  {% endif %}
                  {% if song.printed %}
                  <span class="badge badge-printed px-3 py-2 shadow-sm" title="Piese≈à je u≈æ vytlaƒçen√°">
                    <i class="bi bi-printer-fill me-2"></i>üñ®Ô∏è
                  </span>
                  {% endif %}
                </div>
                
                <!-- PDF Sheet Downloads -->
                {% set sheet_pdfs = song.sheet_pdf_paths|parse_json %}
                {% if sheet_pdfs|length > 0 %}
                <div class="btn-group btn-group-sm" role="group">
                  <a href="{{ url_for('song_detail', song_id=song.id) }}" 
                     class="btn btn-outline-danger btn-sm" 
                     title="Stiahnu≈• noty - {{ sheet_pdfs|length }} s√∫borov">
                    <i class="bi bi-file-music"></i> Noty ({{ sheet_pdfs|length }})
                  </a>
                </div>
                {% endif %}
                
                <!-- PDF Text Downloads -->
                {% if song.pdf_lyrics_path or song.pdf_chords_path %}
                <div class="btn-group btn-group-sm" role="group">
                  {% if song.pdf_lyrics_path %}
                  <a href="{{ url_for('static', filename='uploads/' + song.id|string + '/' + song.pdf_lyrics_path.split('/')[-1]) }}" 
                     class="btn btn-outline-primary btn-sm" 
                     title="Stiahnu≈• text piesne">
                    <i class="bi bi-file-text"></i> Text
                  </a>
                  {% endif %}
                  {% if song.pdf_chords_path %}
                  <a href="{{ url_for('static', filename='uploads/' + song.id|string + '/' + song.pdf_chords_path.split('/')[-1]) }}" 
                     class="btn btn-outline-warning btn-sm" 
                     title="Stiahnu≈• akordy">
                    <i class="bi bi-music-note-beamed"></i> Akordy
                  </a>
                  {% endif %}
                </div>
                {% endif %}
                
                <!-- No files available -->
                {% if not sheet_pdfs and not song.pdf_lyrics_path and not song.pdf_chords_path %}
                <span class="text-muted small">
                  <i class="bi bi-x-circle"></i> ≈Ωiadne PDF s√∫bory
                </span>
                {% endif %}
              </div>
            </td>

            <td class="text-center px-3 py-3">
                <div class="btn-group-vertical btn-group-sm" role="group">
                    <a href="{{ url_for('song_detail', song_id=song.id) }}"
                       class="btn btn-outline-info btn-sm mb-1">
                       <i class="bi bi-eye me-1"></i>Detaily
                    </a>
                    
                    <a href="{{ url_for('song_detail', song_id=song.id) }}"
                       class="btn btn-outline-primary btn-sm mb-1">
                       <i class="bi bi-pencil-square me-1"></i>Upravi≈•
                    </a>

                    <div class="btn-group btn-group-sm" role="group">
                      <form method="POST"
                            action="{{ url_for('generate_tex', song_id=song.id) }}"
                            class="d-inline">
                          <button type="submit"
                                  class="btn btn-outline-warning btn-sm {% if song.admin_checked %}disabled{% endif %}"
                                  {% if song.admin_checked %}title="Admin already checked this song"{% endif %}>
                              <i class="bi bi-file-code"></i>TeX
                          </button>
                      </form>

                      <form method="GET"
                            action="{{ url_for('generate_pdfs', song_id=song.id) }}"
                            class="d-inline">
                          <button type="submit"
                                  class="btn btn-primary btn-sm {% if not song.tex_path or song.admin_checked %}disabled{% endif %}"
                                  style="background-color: #9b59b6; border-color: #9b59b6;"
                                  {% if not song.tex_path %}title="First generate TeX files"{% endif %}
                                  {% if song.admin_checked %}title="Admin already checked this song"{% endif %}>
                              <i class="bi bi-file-pdf"></i>PDF
                          </button>
                      </form>
                    </div>
                </div>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
</div>

<!-- Mobile Card Layout (hidden by default, shown on mobile) -->
<div class="mobile-songs-container d-block d-lg-none">
  {% for song in songs %}
  {% set mp3_files = song.mp3_paths|parse_json %}
  <div class="mobile-song-card song-row" id="mobile-song-{{ song.id }}" data-search-content="{{ song.title|lower if song.title else '' }}" data-categories="{{ song.categories|lower if song.categories else '' }}" data-printed="{{ 'true' if song.printed else 'false' }}" data-checked="{{ 'true' if song.admin_checked else 'false' }}">

    <!-- Main Song Info -->
    <div class="mobile-song-header">
      <div class="mobile-song-info">
        <!-- Song ID and Title -->
        <div class="d-flex align-items-start justify-content-between mb-2">
          <div class="flex-grow-1 me-3">
            <div class="d-flex align-items-center gap-2 mb-2">
              <span class="mobile-song-id">{{ song.song_id }}</span>
              <div class="mobile-song-title flex-grow-1">{{ song.title }}</div>   
            </div>
            
            {% if song.author %}
            <div class="mobile-song-author">
              <i class="bi bi-person me-1"></i>{{ song.author }}
            </div>
            {% endif %}
            
            {% if song.version_name %}
            <div class="text-muted small mt-1">
              <i class="bi bi-tag me-1"></i>{{ song.version_name }}
            </div>
            {% endif %}
          </div>
          
          <!-- Status badges on the right, overlapping -->
          <div class="mobile-status-badges-left">
            {% if song.printed %}
            <span class="status-icon status-printed" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-original-title="Vytlaƒçen√©">
              <i class="bi bi-printer-fill"></i>
            </span>
            {% endif %}

            {% if song.admin_checked %}
            <span class="status-icon status-checked" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-original-title="Skontrolovan√© administr√°torom">
              <i class="bi bi-check-circle-fill"></i>
            </span>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    <!-- Essential Actions (Always Visible) - 4 evenly spaced buttons -->
    <div class="mobile-song-actions-grid">
      <!-- 1. Slov√° (Lyrics) -->
      {% if song.pdf_lyrics_path %}
      <a href="{{ url_for('static', filename='uploads/' + song.id|string + '/' + song.pdf_lyrics_path.split('/')[-1]) }}" class="btn btn-outline-primary btn-sm" title="Stiahnu≈• slov√°" target="_blank">
        <i class="bi bi-file-text"></i>
      </a>
      {% else %}
      <button type="button" class="btn btn-outline-secondary btn-sm" disabled="" title="≈Ωiadne slov√°">
        <i class="bi bi-file-text"></i>
      </button>
      {% endif %}

      <!-- 2. Akordy (Chords) -->
      {% if song.pdf_chords_path %}
      <a href="{{ url_for('static', filename='uploads/' + song.id|string + '/' + song.pdf_chords_path.split('/')[-1]) }}" class="btn btn-outline-warning btn-sm" title="Stiahnu≈• akordy" target="_blank">
        <i class="fa-solid fa-guitar"></i>
      </a>
      {% else %}
      <button type="button" class="btn btn-outline-secondary btn-sm" disabled="" title="≈Ωiadne akordy">
        <i class="fa-solid fa-guitar"></i>
      </button>
      {% endif %}

      <!-- 3. Noty (Sheet Music) -->
      {% set sheet_pdfs = song.sheet_pdf_paths|parse_json %}
      {% if sheet_pdfs|length > 0 %}
        {% if sheet_pdfs|length == 1 %}
        <a href="{{ url_for('download_original_sheet', song_id=song.id, sheet_filename=sheet_pdfs[0].split('/')[-1]) }}" class="btn btn-outline-danger btn-sm" title="Stiahnu≈• noty" target="_blank">
          <i class="fa-solid fa-music"></i>
        </a>
        {% else %}
        <div class="btn-group w-100">
          <button type="button" class="btn btn-outline-danger btn-sm dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="fa-solid fa-music"></i>
          </button>
          <ul class="dropdown-menu w-100">
            <li><h6 class="dropdown-header">Noty s√∫bory</h6></li>
            {% for sheet_pdf in sheet_pdfs %}
            <li>
              <a href="{{ url_for('download_original_sheet', song_id=song.id, sheet_filename=sheet_pdf.split('/')[-1]) }}" class="dropdown-item" target="_blank">
                <i class="fa-solid fa-music text-danger me-2"></i>{{ sheet_pdf.split('/')[-1] }}
              </a>
            </li>
            {% endfor %}
          </ul>
        </div>
        {% endif %}
      {% else %}
        <button type="button" class="btn btn-outline-secondary btn-sm" disabled="" title="≈Ωiadne noty">
          <i class="fa-solid fa-music"></i>
        </button>
      {% endif %}

      <!-- 4. MP3 -->
      {% if mp3_files|length > 0 %}
        {% if mp3_files|length == 1 %}
        <a href="{{ mp3_files[0] | presigned_url }}" class="btn btn-success btn-sm" title="Prehra≈• MP3: {{ mp3_files[0].split('/')[-1] }}" target="_blank">
          <i class="bi bi-volume-up-fill"></i>
        </a>
        {% else %}
        <div class="btn-group w-100">
          <button type="button" class="btn btn-success btn-sm dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false" title="{{ mp3_files|length }} MP3 s√∫borov">
            <i class="bi bi-volume-up-fill"></i>
          </button>
          <ul class="dropdown-menu w-100">
            <li><h6 class="dropdown-header">MP3 S√∫bory</h6></li>
            {% for mp3_file in mp3_files %}
            <li>
              <a class="dropdown-item" href="{{ mp3_file | presigned_url }}" target="_blank">
                <i class="bi bi-volume-up-fill text-success me-2"></i>{{ mp3_file.split('/')[-1] }}
              </a>
            </li>
            {% endfor %}
          </ul>
        </div>
        {% endif %}
      {% else %}
        <button type="button" class="btn btn-outline-secondary btn-sm" disabled="" title="≈Ωiadne MP3 s√∫bory">
          <i class="bi bi-volume-mute"></i>
        </button>
      {% endif %}
    </div>

    <!-- Expandable Section for Additional Functionality -->
    <div class="mobile-expandable">
      <button class="mobile-expand-toggle" type="button" data-bs-toggle="collapse" data-bs-target="#mobile-collapse-{{ song.id }}" aria-expanded="false">
        <i class="bi bi-chevron-down"></i>
        Viac mo≈ænost√≠
      </button>

      <div class="collapse mobile-expanded-content" id="mobile-collapse-{{ song.id }}">

        <!-- Action Buttons -->
        <div class="mobile-files-grid">
          <a href="{{ url_for('song_detail', song_id=song.id) }}" class="btn btn-outline-info btn-sm">
            <i class="bi bi-eye me-1"></i>Detaily
          </a>

          <a href="{{ url_for('song_detail', song_id=song.id) }}" class="btn btn-outline-primary btn-sm">
            <i class="bi bi-pencil-square me-1"></i>Upravi≈•
          </a>

          <!-- Generate TeX Button - Same as table -->
          <form method="POST" action="{{ url_for('generate_tex', song_id=song.id) }}#mobile-song-{{ song.id }}" class="d-inline">
            <button type="submit" class="btn btn-outline-warning btn-sm {% if song.admin_checked %}disabled{% endif %}" {% if song.admin_checked %}title="Admin already checked this song"{% endif %}>
              <i class="bi bi-file-code"></i>TeX
            </button>
          </form>

          <!-- Generate PDF Button - Same as table -->
          <form method="GET" action="{{ url_for('generate_pdfs', song_id=song.id) }}#mobile-song-{{ song.id }}" class="d-inline">
            <button type="submit" class="btn btn-primary btn-sm {% if not song.tex_path or song.admin_checked %}disabled{% endif %}" style="background-color: #9b59b6; border-color: #9b59b6;" {% if not song.tex_path %}title="First generate TeX files"{% endif %} {% if song.admin_checked %}title="Admin already checked this song"{% endif %}>
              <i class="bi bi-file-pdf"></i>PDF
            </button>
          </form>
        </div>

        <!-- Categories -->
        {% if song.categories %}
        <div class="mobile-status-badges">
          <small class="text-muted">Kateg√≥rie:</small>
          {% for category in song.categories.split(';;') %}
            {% if category.strip() %}
          <span class="badge bg-light text-dark">{{ category.strip() }}</span>
            {% endif %}
          {% endfor %}
        </div>
        {% endif %}

      </div>
    </div>
  </div>
  {% endfor %}
</div>

{% if not songs %}
<div class="text-center py-5">
  <div class="mb-4">
    <i class="bi bi-music-note-slash display-1 text-muted"></i>
  </div>
  <h3 class="text-muted">≈Ωiadne piesne nen√°jden√©</h3>
  <p class="text-muted">Skontrolujte ID piesn√≠ v URL.</p>
  <a href="{{ url_for('index') }}" class="btn btn-primary">
    <i class="bi bi-arrow-left me-1"></i>Sp√§≈• na hlavn√Ω zoznam
  </a>
</div>
{% endif %}

<script>
// Copy link to clipboard functionality
function copyToClipboard(text, buttonElement) {
  navigator.clipboard.writeText(text).then(function() {
    // Show success message
    const button = buttonElement;
    const originalText = button.innerHTML;
    button.innerHTML = '<i class="bi bi-check me-1"></i>Skop√≠rovan√©!';
    button.classList.add('btn-success');
    button.classList.remove('btn-outline-info');
    
    setTimeout(function() {
      button.innerHTML = originalText;
      button.classList.remove('btn-success');
      button.classList.add('btn-outline-info');
    }, 2000);
  }).catch(function(err) {
    console.error('Could not copy text: ', err);
    alert('Chyba pri kop√≠rovan√≠ linku');
  });
}

// Enhanced disabled button feedback for mobile
document.addEventListener('DOMContentLoaded', function() {
    // Add mobile tooltips to all disabled buttons
    function addMobileTooltips() {
        const disabledButtons = document.querySelectorAll('button:disabled, button.disabled, .btn:disabled, .btn.disabled');
        
        disabledButtons.forEach(function(button) {
            // Skip if already has tooltip
            if (button.querySelector('.mobile-tooltip')) return;
            
            // Get reason from title attribute or determine based on context
            let reason = button.getAttribute('title') || button.getAttribute('data-reason') || '';
            
            // Determine reason based on button content and context if not explicitly set
            if (!reason) {
                const buttonText = button.textContent.trim().toLowerCase();
                const buttonIcon = button.querySelector('i');
                
                if (buttonText.includes('tex') || (buttonIcon && buttonIcon.className.includes('file-code'))) {
                    reason = 'Piese≈à u≈æ bola skontrolovan√° administr√°torom';
                } else if (buttonText.includes('pdf') || (buttonIcon && buttonIcon.className.includes('file-pdf'))) {
                    if (!button.closest('form')) {
                        reason = 'Najprv vygeneruj TeX s√∫bory';
                    } else {
                        reason = 'Piese≈à u≈æ bola skontrolovan√° administr√°torom';
                    }
                } else if (buttonText.includes('stiahnu≈•') || (buttonIcon && (buttonIcon.className.includes('download') || buttonIcon.className.includes('play') || buttonIcon.className.includes('file-text') || buttonIcon.className.includes('music')))) {
                    reason = 'S√∫bor nie je dostupn√Ω';
                } else {
                    reason = 'Akcia nie je povolen√°';
                }
            }
            
            // Create tooltip element
            const tooltip = document.createElement('div');
            tooltip.className = 'mobile-tooltip';
            tooltip.textContent = reason;
            button.appendChild(tooltip);
            button.style.position = 'relative';
        });
    }
    
    // Handle disabled button clicks/taps
    function handleDisabledButtonClick(event) {
        const button = event.target.closest('button:disabled, button.disabled, .btn:disabled, .btn.disabled');
        if (!button) return;
        
        event.preventDefault();
        event.stopPropagation();
        
        // Show tooltip temporarily
        const tooltip = button.querySelector('.mobile-tooltip');
        if (tooltip) {
            button.classList.add('show-tooltip');
            
            // Vibrate on mobile if supported
            if (navigator.vibrate) {
                navigator.vibrate(100);
            }
            
            // Hide tooltip after 3 seconds
            setTimeout(() => {
                button.classList.remove('show-tooltip');
            }, 3000);
        }
        
        // Show flash message for desktop/larger screens
        if (window.innerWidth >= 768) {
            const reason = button.querySelector('.mobile-tooltip')?.textContent || 'Akcia nie je povolen√°';
            showFlashMessage(reason, 'warning');
        }
    }
    
    // Flash message function
    function showFlashMessage(message, type = 'info') {
        // Remove existing flash messages
        const existingFlash = document.querySelector('.temp-flash-message');
        if (existingFlash) existingFlash.remove();
        
        // Create new flash message
        const flashDiv = document.createElement('div');
        flashDiv.className = `alert alert-${type} alert-dismissible fade show temp-flash-message`;
        flashDiv.style.cssText = 'position: fixed; top: 20px; right: 20px; z-index: 9999; max-width: 300px;';
        flashDiv.innerHTML = `
            <i class="bi bi-exclamation-triangle me-2"></i>
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        
        document.body.appendChild(flashDiv);
        
        // Auto-remove after 5 seconds
        setTimeout(() => {
            if (flashDiv.parentNode) {
                flashDiv.remove();
            }
        }, 5000);
    }
    
    // Initialize tooltips
    addMobileTooltips();
    
    // Add event listeners for disabled button clicks
    document.addEventListener('click', handleDisabledButtonClick, true);
    document.addEventListener('touchstart', handleDisabledButtonClick, true);
    
    // Re-initialize tooltips when content changes (for dynamic content)
    const observer = new MutationObserver(function(mutations) {
        let shouldUpdate = false;
        mutations.forEach(function(mutation) {
            if (mutation.type === 'childList' || mutation.type === 'attributes') {
                shouldUpdate = true;
            }
        });
        if (shouldUpdate) {
            setTimeout(addMobileTooltips, 100);
        }
    });
    
    observer.observe(document.body, {
        childList: true,
        subtree: true,
        attributes: true,
        attributeFilter: ['disabled', 'class']
    });
});
</script>

{% endblock %}
